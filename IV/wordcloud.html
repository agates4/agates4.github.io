<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
            body {
                font-family:"Lucida Grande","Droid Sans",Arial,Helvetica,sans-serif;
            }
            .legend {
                border: 1px solid #555555;
                border-radius: 5px 5px 5px 5px;
                font-size: 0.8em;
                margin: 10px;
                padding: 8px;
            }
            .bld {
                font-weight: bold;
            }
        </style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Information Visualization Project - Spring 2018</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Leaflet Map Style -->
	<link href="css/leaflet.css" rel="stylesheet"/>
	<link href="css/leaflet.draw.css" rel="stylesheet"/>
	<!-- Your Style -->
    <link href="css/MyCSS.css" rel="stylesheet">
	<!-- Leaflet Map api -->
	<script src="js/leaflet-src.js"></script>
	<script src="js/Leaflet.draw.js"></script>
	
	<script src="js/edit/handler/Edit.Poly.js"></script>
	<script src="js/edit/handler/Edit.SimpleShape.js"></script>
	<script src="js/edit/handler/Edit.Circle.js"></script>
	<script src="js/edit/handler/Edit.Rectangle.js"></script>

	<script src="js/draw/handler/Draw.Feature.js"></script>
	<script src="js/draw/handler/Draw.Polyline.js"></script>
	<script src="js/draw/handler/Draw.Polygon.js"></script>
	<script src="js/draw/handler/Draw.SimpleShape.js"></script>
	<script src="js/draw/handler/Draw.Rectangle.js"></script>
	<script src="js/draw/handler/Draw.Circle.js"></script>
    <script src="js/draw/handler/Draw.Marker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="js/d3.layout.cloud.js"></script>
    <link rel="stylesheet" type="text/css" href="../style.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">

	<script src="js/ext/LatLngUtil.js"></script>
	<script src="js/ext/GeometryUtil.js"></script>
	<script src="js/ext/LineUtil.Intersect.js"></script>
	<script src="js/ext/Polyline.Intersect.js"></script>
	<script src="js/ext/Polygon.Intersect.js"></script>

	<script src="js/Control.Draw.js"></script>
	<script src="js/Tooltip.js"></script>
	<script src="js/Toolbar.js"></script>

	<script src="js/draw/DrawToolbar.js"></script>
	<script src="js/edit/EditToolbar.js"></script>
	<script src="js/edit/handler/EditToolbar.Edit.js"></script>
	<script src="js/edit/handler/EditToolbar.Delete.js"></script>
	<script src="js/communist.js"></script>
	<script src="js/TArr.js"></script>
    <script src="../D3Scripts/scatterPlot.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
	<!-- Your js File -->
    <!-- <script src="js/Myjs.js"></script> -->
  </head>
  <body>

    
  </body>

  <script>
        d3.json("https://raw.githubusercontent.com/agates4/agates4.github.io/master/IV/js/trips.json", function (d) {
            // Data filteration remove rows containe negative value
            d = d.features;
            var streetnames = d.map(function(a) {
                return a.properties.streetnames;
            });

            var avspeed = d.map(function(a) {
                return a.properties.avspeed;
            });

            var distance = d.map(function(a) {
                return a.properties.distance;
            });

            var duration = d.map(function(a) {
                return a.properties.duration;
            });

            getStreetWords(streetnames);
            // data = data.filter(function (d) {
            //     if (d["Cups per Serving"] >= 0 && d["Serving Size Weight"] >= 0 && d[
            //             "Vitamins and Minerals"] >= 0 && d["Potassium"] >= 0 && d["Display Shelf"] >= 0 &&
            //         d["Sugars"] >= 0 &&
            //         d["Carbs"] >= 0 && d["Dietary Fiber"] >= 0 && d["Sodium"] >= 0 && d["Fat"] >= 0 &&
            //         d["Protein (g)"] >= 0 && d["Calories"] >= 0) {
            //         return d;
            //     }
            // });
            // // Average values for Manufacturer
            // var nested_data = d3.nest()
            //     .key(function (d) {
            //         return d.Manufacturer;
            //     })
            //     .rollup(function (leaves) {
            //         return d3.mean(leaves, function (d) {
            //             return parseFloat(d.Calories);
            //         })
            //     })
            //     .entries(data);
            // // Draw Scatter Map
            
            // // Draw Bar Chart
            // drawBarChart('#chart2', nested_data);
        });

        function getStreetWords(result) {
            var counts = {};
            for (var i = 0; i < result.length; i++) {
                var num = result[i];
                for (let index = 0; index < num.length; index++) {
                    const element = num[index];
                    if(counts[element]) {
                        counts[element] += 1;
                    }
                    else
                        counts[element] = 1;
                }
            }
            frequency_list = []
            for (var key in counts) {
                frequency_list.push({"text":key,"size":counts[key] / 50 < 1 ? 5 : counts[key] / 50})
                // $('#chart1').append("<text style=\"font-size:" + counts[key] + ";\">" + key + "</text>")
                // console.log(key, counts[key]);
            }
            console.log(frequency_list)

            var color = d3.scale.linear()
                    .domain([0,1,2,3,4,5,6,10,15,20,100])
                    .range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);

            d3.layout.cloud().size([3000, 3000])
                    .words(frequency_list)
                    .rotate(0)
                    .fontSize(function(d) { return d.size; })
                    .on("end", draw)
                    .start();

            function draw(words) {
                d3.select("body").append("svg")
                        .attr("width", 850)
                        .attr("height", 350)
                        .attr("class", "wordcloud")
                        .append("g")
                        // without the transform, words words would get cutoff to the left and top, they would
                        // appear outside of the SVG area
                        .attr("transform", "translate(320,200)")
                        .selectAll("text")
                        .data(words)
                        .enter().append("text")
                        .style("font-size", function(d) { return d.size + "px"; })
                        .style("fill", function(d, i) { return color(i); })
                        .attr("transform", function(d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        }).on("click", function(d){
                            alert("frequency: " + counts[d.text])
                        })
                        .text(function(d) { return d.text; });
            }
        }
    </script>
</html>